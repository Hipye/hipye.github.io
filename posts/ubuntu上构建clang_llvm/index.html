<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.114.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Ubuntu上构建clang|llvm&nbsp;&ndash;&nbsp;拾集</title><link rel=stylesheet href=/css/core.min.b2bc2c4c4e30196c8db198fda67dfe141702fbfe6f235c905570254e24ec587e5062f362943258cf1868316b87452d21.css integrity=sha384-srwsTE4wGWyNsZj9pn3+FBcC+/5vI1yQVXAlTiTsWH5QYvNilDJYzxhoMWuHRS0h><meta name=twitter:card content="summary"><meta name=twitter:title content="Ubuntu上构建clang|llvm"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/images/avatar.png alt><span class="site name">拾集</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>分类</a><a class="nav item" href=/tags/>标签</a><a class="nav item" href></a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Ubuntu上构建clang|llvm</h1><p class="article date">2023-09-22<span class=lastmod> • 更新于 2023-10-25</span><span class=reading-time> • 预计阅读时间 1 分钟</span></p></section><article class="article markdown-body"><p>gcc和g++经常使用但是clang的趋势慢慢上来，所以这里单独构建一个llvm包<a href=https://github.com/llvm/llvm-project/releases/tag/llvmorg-15.0.7 target=_blank rel="noopener noreferrer">LLVM 15.0.7</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install build-essential ninja-build python3 cmake
</span></span></code></pre></div><p>下载源码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/llvm/llvm-project/releases/download/llvmorg-15.0.7/llvm-project-15.0.7.src.tar.xz
</span></span><span class=line><span class=cl>wget https://github.com/llvm/llvm-project/releases/download/llvmorg-15.0.7/clang-15.0.7.src.tar.xz
</span></span><span class=line><span class=cl>wget https://github.com/llvm/llvm-project/releases/download/llvmorg-15.0.7/cmake-15.0.7.src.tar.xz
</span></span><span class=line><span class=cl>wget https://github.com/llvm/llvm-project/releases/download/llvmorg-15.0.7/llvm-15.0.7.src.tar.xz
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>cmake</span> <span class=n>-G</span> <span class=n>Ninja</span> <span class=n>-DCMAKE_BUILD_TYPE</span><span class=p>=</span><span class=s2>&#34;Release&#34;</span> <span class=n>-DLLVM_ENABLE_PROJECTS</span><span class=p>=</span><span class=s2>&#34;llvm&#34;</span> <span class=p>\</span>
</span></span><span class=line><span class=cl><span class=n>-DLLVM_ENABLE_RUNTIMES</span><span class=p>=</span><span class=s2>&#34;clang;libcxx;libcxxabi&#34;</span> <span class=p>\</span>
</span></span><span class=line><span class=cl><span class=n>-DCMAKE_INSTALL_PREFIX</span><span class=p>=/</span><span class=n>inspack</span><span class=p>/</span><span class=n>compiler</span> <span class=p>../</span><span class=n>llvm</span>
</span></span></code></pre></div><p>使用ninja构建，编译速度优化
ninja必须先创建build文件夹 <code>../llvm</code>是llvm所在目录</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cmake ../llvm -G Ninja -DCMAKE_BUILD_TYPE<span class=o>=</span>RELEASE <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-DLLVM_ENABLE_PROJECTS<span class=o>=</span><span class=s2>&#34;clang;lld;libcxx;libcxxabi&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-DCMAKE_INSTALL_PREFIX<span class=o>=</span>/inspack/compiler -DLLVM_OPTIMIZED_TABLEGEN<span class=o>=</span>ON
</span></span></code></pre></div><p><strong>一般内存使用空间会不够报错，所以需要增加swap分区大小（6g左右）</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo touch /swapfile
</span></span><span class=line><span class=cl><span class=nb>cd</span> /swapfile
</span></span><span class=line><span class=cl>sudo dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>swapfile <span class=nv>bs</span><span class=o>=</span><span class=m>1024</span> <span class=nv>count</span><span class=o>=</span><span class=m>67108864</span>
</span></span><span class=line><span class=cl>sudo mkswap -f swapfile
</span></span><span class=line><span class=cl>sudo swapon swapon
</span></span></code></pre></div><p>切换系统编译器
可以使用以下命令来设置默认编译器为 clang</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo update-alternatives --set cc /usr/bin/clang
</span></span><span class=line><span class=cl>sudo update-alternatives --set c++ /usr/bin/clang++
</span></span></code></pre></div><p>这将把 /usr/bin/cc 和 /usr/bin/c++ 符号链接指向 /usr/bin/clang 和 /usr/bin/clang++。</p><p>如果你想将默认编译器切换回 gcc，可以运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo update-alternatives --set cc /usr/bin/gcc
</span></span><span class=line><span class=cl>sudo update-alternatives --set c++ /usr/bin/g++
</span></span></code></pre></div></article><section class="article labels"><a class=category href=/categories/></a><a class=tag href=/tags/></a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/git%E5%88%87%E6%8D%A2%E5%88%86%E6%94%AF/><span class="iconfont icon-article"></span>Git切换分支</a></p><p><a class=link href=/posts/sed%E5%91%BD%E4%BB%A4%E7%BB%86%E8%8A%82/><span class="iconfont icon-article"></span>Sed命令细节</a></p></section><section class="article discussion"><script src=https://utteranc.es/client.js repo=Hipye/morris issue-term=pathname label theme=github-light crossorigin=anonymous async></script></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>©2019 Moriz.</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XXXXXXXXXX",{anonymize_ip:!1})}</script><script src=/js/core.min.5c7b67437ff4e36acca5d4f8fd7094276f09573657d699a765d6ad6b40a7c4e00993c7f07cb6637e726ae7c3f77fc968.js integrity=sha384-XHtnQ3/042rMpdT4/XCUJ28JVzZX1pmnZdata0CnxOAJk8fwfLZjfnJq58P3f8lo></script></body></html>