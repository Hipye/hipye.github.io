<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.105.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Ubuntu编译openwrt&nbsp;&ndash;&nbsp;拾集</title><link rel=stylesheet href=/css/core.min.eef42685ca19d66e233c82b38f89dee2263bef47ad7d7fa174fc03d35083eb9fcbe1bd670b208539d1ffcd57828732f1.css integrity=sha384-7vQmhcoZ1m4jPIKzj4ne4iY770etfX+hdPwD01CD65/L4b1nCyCFOdH/zVeChzLx><meta name=twitter:card content="summary"><meta name=twitter:title content="Ubuntu编译openwrt"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">拾集</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>归档</a><a class="nav item" href=/tags/>标签</a><a class="nav item" href=/about>相关</a><a class="nav item" href></a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Ubuntu编译openwrt</h1><p class="article date">2022-11-10<span class=lastmod> • edited 2022-11-11</span><span class=reading-time> • 2 minutes to read</span></p></section><article class="article markdown-body"><p>无论是潘多拉还是openwrt还是其他固件其底包都需要编译支持由于个人比较喜欢openwrt的高自由度所以特地列举编译固件当中遇到的报错以及问题。</p><p>固件首先使用的是<code>win10</code>的<code>wsl</code>建<code>ubuntu20.04</code>开始编译</p><h3 id=本地编译>本地编译</h3><p>添加依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get update -y 
</span></span><span style=display:flex><span>sudo apt-get install -y git <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>subversion <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>g++ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>zlib1g-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>build-essential <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>python <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>python3 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>python3-distutils <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>libncurses5-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>gawk <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>gettext <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>unzip <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>libssl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>libelf-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>ecj <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>fastjar <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>java-propose-classpath <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>build-essential <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>libncursesw5-dev <span style=color:#ae81ff>\
</span></span></span></code></pre></div><h3 id=下载源码>下载源码</h3><p>clone<a href=https://github.com/coolsnowwolf/lede.git target=_blank rel="noopener noreferrer">[lean]</a>
源码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/coolsnowwolf/lede.git 
</span></span></code></pre></div><h3 id=添加第三方软件包>添加第三方软件包</h3><p>先编辑基础配置文件
<strong>feeds.conf.default</strong> 这个文本类似软件包配置</p><ul><li>[√] kenzo是第三方基础源有想用的软件包</li><li>[√] small是依赖包必须要添加</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;src-git kenzo https://github.com/kenzok8/openwrt-packages&#34;</span> &gt;&gt; feeds.conf.default
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;src-git small https://github.com/kenzok8/small&#34;</span> &gt;&gt; feeds.conf.default
</span></span></code></pre></div><h3 id=第三方软件更新安装>第三方软件更新&安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./scripts/feeds clean 
</span></span><span style=display:flex><span>./scripts/feeds update -a 
</span></span><span style=display:flex><span>./scripts/feeds  install -a 
</span></span><span style=display:flex><span>make menuconfig 
</span></span></code></pre></div><p>前两项的必须选好 第一项是选择cpu的类别 第二项是你的路由型号</p><h3 id=dl包>dl包</h3><p><del>由于国内的网络环境导致在下载所需软件包时会导致失败这里提供一个国内dl镜像
<a href=https://gitee.com/tolqy/openwrt-lede-dl target=_blank rel="noopener noreferrer">gitee</a></del></p><h3 id=修改默认网关地址>修改默认网关地址</h3><p>不喜欢路由器的默认地址<code>192.168.1.1</code>自己修改
有多台路由时避免网关重复，这一步多设备必修改。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim package/base-files/files/bin/config_generate
</span></span></code></pre></div><h3 id=修改默认wifi的选项默认wifi无密码>修改默认wifi的选项<code>默认wifi无密码</code></h3><p>lede/package/kernel/mac80211/files/lib/wifi</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>set wireless.default_radio<span style=color:#e6db74>${</span>devidx<span style=color:#e6db74>}</span>.encryption<span style=color:#f92672>=</span>WPA2-PSK <span style=color:#75715e>#设置加密协议</span>
</span></span><span style=display:flex><span>set wireless.default_radio<span style=color:#e6db74>${</span>devidx<span style=color:#e6db74>}</span>.key<span style=color:#f92672>=</span> <span style=color:#75715e>#密码</span>
</span></span></code></pre></div><p><code>已经编译过的必须删除旧有文件</code></p><pre tabindex=0><code>rm -rf build_dir/ &amp;&amp; rm -rf staging_dir/ &amp;&amp; rm -rf tmp/
</code></pre><p>ssh连接开屏提醒</p><pre tabindex=0><code>package/base-files/files/etc/banner
</code></pre><h3 id=gcc版本>gcc版本</h3><p>解决gcc版本过低网络条件不佳则可以将源换成<code>https://launchpad.proxy.ustclug.org</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install software-properties-common
</span></span><span style=display:flex><span>sudo add-apt-repository ppa:ubuntu-toolchain-r/test
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install gcc-11 g++-11
</span></span><span style=display:flex><span>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 <span style=color:#ae81ff>60</span> --slave /usr/bin/g++ g++ /usr/bin/g++-11
</span></span></code></pre></div><h3 id=wsl编译最后一步编译必须添加前置>wsl编译最后一步编译必须添加前置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PATH<span style=color:#f92672>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin 
</span></span></code></pre></div><h3 id=编译>编译</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make download -j12
</span></span><span style=display:flex><span>make -j8 V<span style=color:#f92672>=</span>s 
</span></span></code></pre></div><p>特别提醒 国内特殊的网络条件下在使用<code>make download</code>下载依赖包时建议挂上全局避免直接404导致后面编译报error
编译好的固件在/lede/bin/targets/xxx下</p><h3 id=二次编译>二次编译</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./scripts/feeds update -a
</span></span><span style=display:flex><span>./scripts/feeds install -a
</span></span><span style=display:flex><span> make defconfig
</span></span><span style=display:flex><span> make -j12 download
</span></span><span style=display:flex><span> make -j8 V<span style=color:#f92672>=</span>s
</span></span></code></pre></div><ul><li>第三方编译软件包 <a href=https://github.com/OpenWrt-Actions/lienol-openwrt-package target=_blank rel="noopener noreferrer">[Lienol/openwrt备份]</a></li><li>官方原版 <a href=https://github.com/openwrt/openwrt target=_blank rel="noopener noreferrer">[openwrt]</a></li><li>第三方固件地址国内镜像<a href=https://gitee.com/qmgta/lede target=_blank rel="noopener noreferrer">[gitee]</a></li><li>利用CI自动构建项目 <a href=https://github.com/kenzok8/openwrt_Build target=_blank rel="noopener noreferrer">[openwrt_Build]</a></li><li>自定义网关地址以及无线网络名称 <a href=http://www.5lazy.cn/post-147.html target=_blank rel="noopener noreferrer">[源码修改]</a></li></ul></article></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/post/fishshell%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/><span class="iconfont icon-article"></span>FishShell基础配置指南</a></p><p><a class=link href=/post/ndk%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91aria2/><span class="iconfont icon-article"></span>Ndk交叉编译aria2</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>©2019 Notepadium.</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><script src=/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/copy-to-clipboard.js></script></body></html>