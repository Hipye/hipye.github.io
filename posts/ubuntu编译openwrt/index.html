<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.105.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=google-site-verification content="AsHOUXvrnOA93vxhoMbbXs5tMB7_Hs1_iDtR9d6LYiI"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><link rel=bookmark type=image/x-icon href=images/avatar.png><link rel=icon type=image/x-icon href=images/avatar.png><link rel="shortcut icon" type=image/x-icon href=images/avatar.png><script async src="https://www.googletagmanager.com/gtag/js?id=UA-109916879-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-109916879-1")</script><title>Ubuntu编译openwrt&nbsp;&ndash;&nbsp;拾集</title><link rel=stylesheet href=/css/core.min.ae9e5febc479f9f69eacf20e7a343d20eb9ea95227e498ba8da9527e35ebbc500c141dabde95f7434b78e0a5a9860f2c.css integrity=sha384-rp5f68R5+faerPIOejQ9IOueqVIn5Ji6jalSfjXrvFAMFB2r3pX3Q0t44KWphg8s><meta name=twitter:card content="summary"><meta name=twitter:title content="Ubuntu编译openwrt"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">拾集</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/archives/>归档 </a><a class="nav item" href=/categories/>分类 </a><a class="nav item" href=/tags/>标签</a>
<a class="nav item" href></a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Ubuntu编译openwrt</h1><p class="article date">2022-11-11
<span class=wordcount>&nbsp;•&nbsp;共&nbsp;778&nbsp;个字</span><span class=reading-time> • 预计阅读时间 2 分钟</span></p></section><aside id=toc-container class="toc-container wide"><div class=toc><h3>文章目录</h3><div class=inner><ul><li><a href=#%e6%9c%ac%e5%9c%b0%e7%bc%96%e8%af%91 aria-label=本地编译>本地编译</a></li><li><a href=#%e4%b8%8b%e8%bd%bd%e6%ba%90%e7%a0%81 aria-label=下载源码>下载源码</a></li><li><a href=#%e6%b7%bb%e5%8a%a0%e7%ac%ac%e4%b8%89%e6%96%b9%e8%bd%af%e4%bb%b6%e5%8c%85 aria-label=添加第三方软件包>添加第三方软件包</a></li><li><a href=#%e7%ac%ac%e4%b8%89%e6%96%b9%e8%bd%af%e4%bb%b6%e6%9b%b4%e6%96%b0%e5%ae%89%e8%a3%85 aria-label=第三方软件更新&amp;amp;安装>第三方软件更新&安装</a></li><li><a href=#dl%e5%8c%85 aria-label=dl包>dl包</a></li><li><a href=#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4%e7%bd%91%e5%85%b3%e5%9c%b0%e5%9d%80 aria-label=修改默认网关地址>修改默认网关地址</a></li><li><a href=#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4wifi%e7%9a%84%e9%80%89%e9%a1%b9%e9%bb%98%e8%ae%a4wifi%e6%97%a0%e5%af%86%e7%a0%81 aria-label=修改默认wifi的选项默认wifi无密码>修改默认wifi的选项<code>默认wifi无密码</code></a></li><li><a href=#gcc%e7%89%88%e6%9c%ac aria-label=gcc版本>gcc版本</a></li><li><a href=#wsl%e7%bc%96%e8%af%91%e6%9c%80%e5%90%8e%e4%b8%80%e6%ad%a5%e7%bc%96%e8%af%91%e5%bf%85%e9%a1%bb%e6%b7%bb%e5%8a%a0%e5%89%8d%e7%bd%ae aria-label=wsl编译最后一步编译必须添加前置>wsl编译最后一步编译必须添加前置</a></li><li><a href=#%e7%bc%96%e8%af%91 aria-label=编译>编译</a></li><li><a href=#%e4%ba%8c%e6%ac%a1%e7%bc%96%e8%af%91 aria-label=二次编译>二次编译</a></li></ul></div></div></aside><article class="article markdown-body"><div><p>无论是潘多拉还是openwrt还是其他固件其底包都需要编译支持由于个人比较喜欢openwrt的高自由度所以特地列举编译固件当中遇到的报错以及问题。</p><p>固件首先使用的是<code>win10</code>的<code>wsl</code>建<code>ubuntu20.04</code>开始编译</p><h3 id=本地编译>本地编译</h3><p>添加依赖</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update -y 
</span></span><span class=line><span class=cl>sudo apt-get install -y git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>subversion <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>g++ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>zlib1g-dev <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>build-essential <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>python <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>python3 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>python3-distutils <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libncurses5-dev <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>gawk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>gettext <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>unzip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>file <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libssl-dev <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libelf-dev <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>ecj <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>fastjar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>java-propose-classpath <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>build-essential <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libncursesw5-dev <span class=se>\
</span></span></span></code></pre></div><h3 id=下载源码>下载源码</h3><p>clone<a href=https://github.com/coolsnowwolf/lede.git target=_blank rel="noopener noreferrer">[lean]</a>
源码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/coolsnowwolf/lede.git 
</span></span></code></pre></div><h3 id=添加第三方软件包>添加第三方软件包</h3><p>先编辑基础配置文件
<strong>feeds.conf.default</strong> 这个文本类似软件包配置</p><ul><li>[√] kenzo是第三方基础源有想用的软件包</li><li>[√] small是依赖包必须要添加</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;src-git kenzo https://github.com/kenzok8/openwrt-packages&#34;</span> &gt;&gt; feeds.conf.default
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;src-git small https://github.com/kenzok8/small&#34;</span> &gt;&gt; feeds.conf.default
</span></span></code></pre></div><h3 id=第三方软件更新安装>第三方软件更新&安装</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./scripts/feeds clean 
</span></span><span class=line><span class=cl>./scripts/feeds update -a 
</span></span><span class=line><span class=cl>./scripts/feeds  install -a 
</span></span><span class=line><span class=cl>make menuconfig 
</span></span></code></pre></div><p>前两项的必须选好 第一项是选择cpu的类别 第二项是你的路由型号</p><h3 id=dl包>dl包</h3><p><del>由于国内的网络环境导致在下载所需软件包时会导致失败这里提供一个国内dl镜像
<a href=https://gitee.com/tolqy/openwrt-lede-dl target=_blank rel="noopener noreferrer">gitee</a></del></p><h3 id=修改默认网关地址>修改默认网关地址</h3><p>不喜欢路由器的默认地址<code>192.168.1.1</code>自己修改
有多台路由时避免网关重复，这一步多设备必修改。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim package/base-files/files/bin/config_generate
</span></span></code></pre></div><h3 id=修改默认wifi的选项默认wifi无密码>修改默认wifi的选项<code>默认wifi无密码</code></h3><p>lede/package/kernel/mac80211/files/lib/wifi</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>set</span> wireless.default_radio<span class=si>${</span><span class=nv>devidx</span><span class=si>}</span>.encryption<span class=o>=</span>WPA2-PSK <span class=c1>#设置加密协议</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> wireless.default_radio<span class=si>${</span><span class=nv>devidx</span><span class=si>}</span>.key<span class=o>=</span> <span class=c1>#密码</span>
</span></span></code></pre></div><p><code>已经编译过的必须删除旧有文件</code></p><pre tabindex=0><code>rm -rf build_dir/ &amp;&amp; rm -rf staging_dir/ &amp;&amp; rm -rf tmp/
</code></pre><p>ssh连接开屏提醒</p><pre tabindex=0><code>package/base-files/files/etc/banner
</code></pre><h3 id=gcc版本>gcc版本</h3><p>解决gcc版本过低网络条件不佳则可以将源换成<code>https://launchpad.proxy.ustclug.org</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install software-properties-common
</span></span><span class=line><span class=cl>sudo add-apt-repository ppa:ubuntu-toolchain-r/test
</span></span><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install gcc-11 g++-11
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 <span class=m>60</span> --slave /usr/bin/g++ g++ /usr/bin/g++-11
</span></span></code></pre></div><h3 id=wsl编译最后一步编译必须添加前置>wsl编译最后一步编译必须添加前置</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>PATH</span><span class=o>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin 
</span></span></code></pre></div><h3 id=编译>编译</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>make download -j12
</span></span><span class=line><span class=cl>make -j8 <span class=nv>V</span><span class=o>=</span>s 
</span></span></code></pre></div><p>特别提醒 国内特殊的网络条件下在使用<code>make download</code>下载依赖包时建议挂上全局避免直接404导致后面编译报error
编译好的固件在/lede/bin/targets/xxx下</p><h3 id=二次编译>二次编译</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./scripts/feeds update -a
</span></span><span class=line><span class=cl>./scripts/feeds install -a
</span></span><span class=line><span class=cl> make defconfig
</span></span><span class=line><span class=cl> make -j12 download
</span></span><span class=line><span class=cl> make -j8 <span class=nv>V</span><span class=o>=</span>s
</span></span></code></pre></div><ul><li>第三方编译软件包 <a href=https://github.com/OpenWrt-Actions/lienol-openwrt-package target=_blank rel="noopener noreferrer">[Lienol/openwrt备份]</a></li><li>官方原版 <a href=https://github.com/openwrt/openwrt target=_blank rel="noopener noreferrer">[openwrt]</a></li><li>第三方固件地址国内镜像<a href=https://gitee.com/qmgta/lede target=_blank rel="noopener noreferrer">[gitee]</a></li><li>利用CI自动构建项目 <a href=https://github.com/kenzok8/openwrt_Build target=_blank rel="noopener noreferrer">[openwrt_Build]</a></li><li>自定义网关地址以及无线网络名称 <a href=http://www.5lazy.cn/post-147.html target=_blank rel="noopener noreferrer">[源码修改]</a></li></ul></div></article><section class="article labels"><a class=category href=/categories/></a><a class=tag href=/tags/></a></section></div><div class="article bottom"><div class="article bottom title">更多文章</div><section class="article navigation"><p><a class=link href=/posts/%E7%BC%96%E8%AF%91aria2%E6%B7%BB%E5%8A%A0128%E7%BA%BF%E7%A8%8B%E4%B8%8B%E8%BD%BD/><span class="iconfont icon-article"></span>编译aria2添加128线程下载</a></p><p><a class=link href=/posts/ndk%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91aria2/><span class="iconfont icon-article"></span>Ndk交叉编译aria2</a></p></section><section class="article discussion"><script src=https://utteranc.es/client.js repo=Hipye/mirris issue-term=pathname label theme=github-light crossorigin=anonymous async></script></section><div class=nav-bottom><div class="nav wrap bottom"><nav class=nav><a class="nav item" href=/archives/>归档 </a><a class="nav item" href=/categories/>分类 </a><a class="nav item" href=/tags/>标签</a></nav></div></div></div></section><section id=footer><div class=tongji style=text-align:center><span>共 6 篇文章 • 总计 8487 字</span></div><div class=footer-wrap><p class=copyright>©2019 Moriz.</p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank rel="noopener noreferrer">Notepadium</a></p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script src=/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/core.min.5c7b67437ff4e36acca5d4f8fd7094276f09573657d699a765d6ad6b40a7c4e00993c7f07cb6637e726ae7c3f77fc968.js integrity=sha384-XHtnQ3/042rMpdT4/XCUJ28JVzZX1pmnZdata0CnxOAJk8fwfLZjfnJq58P3f8lo></script>
<script src=https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js></script>
<script type=text/javascript>var myChart=echarts.init(document.getElementById("heatmap")),option,data,rangeArr,listeners;window.onresize=function(){myChart.resize()};function heatmap_width(e){var t=new Date,o=t.setMonth(t.getMonth()-e),n=+new Date,t=+new Date(o),n=echarts.format.formatTime("yyyy-MM-dd",n),t=echarts.format.formatTime("yyyy-MM-dd",t),s=[];return s.push([t,n]),s}data=[],data.push(["2022-11-11",704]),data.push(["2022-11-11",778]),data.push(["2022-11-11",1042]),data.push(["2022-11-11",1253]),data.push(["2022-11-11",4311]),data.push(["2022-11-11",250]),data.push(["2019-05-28",0]),data.push(["2019-02-28",149]),data.push(["0001-01-01",0]),window.matchMedia("(max-width: 320px)").matches?(rangeArr=heatmap_width(3)):window.matchMedia("(max-width: 400px)").matches?(rangeArr=heatmap_width(5)):window.matchMedia("(max-width: 550px)").matches?(rangeArr=heatmap_width(6)):window.matchMedia("(max-width: 1021px)").matches?(rangeArr=heatmap_width(12)):window.matchMedia("(max-width: 1400px)").matches?(rangeArr=heatmap_width(9)):window.matchMedia("(max-width: 1920px)").matches?(rangeArr=heatmap_width(12)):window.matchMedia("(max-width: 2560px)").matches&&(rangeArr=heatmap_width(24));function LightOption(){option={title:{show:!0,top:0,left:20,text:"文章热力图",textStyle:{color:"rgba(29,43,76,.85)",fontSize:10}},tooltip:{padding:10,backgroundColor:"#777",borderColor:"#777",borderWidth:1,formatter:function(e){var t=e.value;return'<div style="font-size: 14px;color: white;">'+t[0]+": "+t[1]+"</div>"}},visualMap:{show:!1,top:0,min:0,max:5e3,textStyle:{color:"#7bc96f",fontWeight:"bold",fontFamily:"monospace"},calculable:!0,inRange:{symbol:"rect",color:["#ccffcc","#82c979","#43923c","#125b15","#002800"]},itemWidth:12,itemHeight:200,orient:"horizontal",right:0},calendar:{top:45,left:30,right:30,cellSize:[12,12],orient:"horizontal",range:rangeArr,splitLine:{show:!1,lineStyle:{width:.5,type:"solid",color:"white"}},itemStyle:{borderWidth:3.4,borderType:"solid",shadowColor:"#f3f6f9",shadowBlur:1.2,borderColor:"#f3f6f9",color:"#dddddd",opacity:1},yearLabel:{show:!0,position:"top",fontWeight:"normal",fontSize:12,color:"#24292e"},monthLabel:{nameMap:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fontWeight:"bolder",color:"#24292e",fontSize:8},dayLabel:{formatter:"{start}  1st",fontWeight:"bolder",nameMap:["","Mon","","Wed","","Fri",""],color:"#24292e",fontSize:8}},series:{type:"heatmap",coordinateSystem:"calendar",data}},option&&myChart.setOption(option)}function DarkOption(){option={title:{show:!0,top:0,left:20,text:"文章热力图",textStyle:{color:"#c7d5f6",fontSize:10}},tooltip:{padding:10,backgroundColor:"#777",borderColor:"#777",borderWidth:1,formatter:function(e){var t=e.value;return'<div style="font-size: 14px;color: white;">'+t[0]+": "+t[1]+"</div>"}},visualMap:{show:!1,top:0,min:0,max:5e3,textStyle:{color:"#c7d5f6",fontWeight:"bold",fontFamily:"monospace"},calculable:!0,inRange:{symbol:"rect",color:["#ccffcc","#82c979","#43923c","#125b15","#002800"],opacity:.8},itemWidth:12,itemHeight:200,orient:"horizontal",right:0},calendar:{top:45,left:30,right:30,cellSize:[12,12],orient:"horizontal",range:rangeArr,splitLine:{show:!1,lineStyle:{width:.5,type:"solid",color:"white"}},itemStyle:{borderWidth:3.4,borderType:"solid",shadowColor:"#0d1117",shadowBlur:1.2,borderColor:"#0d1117",color:"#24292e",opacity:1},yearLabel:{show:!0,position:"top",fontWeight:"normal",fontSize:12,color:"#c7d5f6"},monthLabel:{nameMap:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fontWeight:"bolder",color:"#c7d5f6",fontSize:8},dayLabel:{formatter:"{start}  1st",fontWeight:"bolder",nameMap:["","Mon","","Wed","","Fri",""],color:"#c7d5f6",fontSize:8}},series:{type:"heatmap",coordinateSystem:"calendar",data}},option&&myChart.setOption(option)}window.matchMedia("(prefers-color-scheme: dark)").matches?DarkOption():LightOption(),listeners={dark:e=>{e.matches&&DarkOption()},light:e=>{e.matches&&LightOption()}},window.matchMedia("(prefers-color-scheme: dark)").addListener(listeners.dark),window.matchMedia("(prefers-color-scheme: light)").addListener(listeners.light)</script></body></html>